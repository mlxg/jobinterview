<html>
<head>
  <title>前端页面渲染</title>
  <basefont face="Tahoma" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/274870; Windows/6.3.9600;"/>
  <style>
    body, td {
      font-family: Tahoma;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="690"/>
<h1>前端页面渲染</h1>

<div>
<span style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;"><div><b>浏览器工作流程</b></div><div><hr/></div><div>加载：根据请求的URL进行域名解析，向服务器发起请求，接收文件（HTML、JS、CSS、图象等）。</div><div><br/></div><div>解析：对加载到的资源（HTML、JS、CSS等）进行语法解析，建议相应的内部数据结构（比如HTML的DOM树，JS的（对象）属性表，CSS的样式规则等等）</div><div><br/></div><div>渲染：构建渲染树，对各个元素进行位置计算、样式计算等等，然后根据渲染树对页面进行渲染（可以理解为“画”元素）</div><div><br/></div><div><br/></div><div><b>页面加载和渲染的过程</b></div><div><hr/></div><div>与用户请求的站点建立网络连接--&gt;解析HTML--&gt;请求相关资源--&gt;</div><div><br/></div><div>浏览器在执行Javascript期间无法响应其他的用户事件。</div><div><br/></div><div>浏览器下载的顺序是从上到下，渲染的顺序也是从上到下，下载和渲染是同时进行的。</div><div><br/></div><div>在渲染到页面的某一部分时，其上面的所有部分都已经下载完成（并不是说所有相关联的元素都已经下载完）。</div><div><br/></div><div>如果遇到语义解释性的标签嵌入文件（JS脚本，CSS样式），那么此时IE的下载过程会启用单独连接进行下载。</div><div><br/></div><div>并且在下载后进行解析，解析过程中，停止页面所有往下元素的下载。</div><div><br/></div><div>样式表在下载完成后，将和以前下载的所有样式表一起进行解析，解析完成后，将对此前所有元素（含以前已经渲染的）重新进行渲染。</div><div><br/></div><div>JS、CSS中如有重定义，后定义函数将覆盖前定义函数。</div><div><br/></div><div>浏览器CSS匹配不是从左到右进行查找，而是从右到左进行查找。比如之前说的DIV#divBox p span.red{color:red;}，浏览器 的查找顺序如下：先查找html中所有class=’red’的span元素，找到后，再查找其父辈元素中是否有p元素，再判断p的父元素中是否有id为 divBox的div元素，如果都存在则CSS匹配上。</div><div><br/></div><div>浏览器从右到左进行查找的好处是为了尽早过滤掉一些无关的样式规则和元素。firefox称这种查 找方式为keyselector(关键字查询)，所谓的关键字就是样式规则中最后(最右边)的规则，上面的key就是span.red</div><div><br/></div><div><span style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px; background-color: rgb(255, 255, 255);">浏览器是怎样渲染一个页面的？</span><br style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px;"/><br style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px;"/><span style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px; background-color: rgb(255, 255, 255);">我们从浏览器渲染页面的大概过程开始说起：</span><br style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px;"/><br style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px;"/><span style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px; background-color: rgb(255, 255, 255);">  1. 由从服务器接收到的 HTML 形成 DOM（文档对象模型）。</span><br style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px;"/><span style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px; background-color: rgb(255, 255, 255);">  2. 样式被加载和解析，形成 CSSOM（CSS 对象模型）。</span><br style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px;"/><span style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px; background-color: rgb(255, 255, 255);">  3. 紧接着 DOM 和 CSSOM 创建了一个渲染树，这个渲染树是一些被渲染对象的集合（ Webkit 分别叫它们”renderer”和”render object”，而在Gecko 引擎中叫”frame”）。除了不可见的元素（比如 head 标签和一些有 display:none 属性的元素），渲染树映射了 DOM 的结构。在渲染树中，每一个文本字符串都被当做一个独立的 renderer。每个渲染对象都包含了与之对应的计算过样式的DOM 对象（或者一个文本块）。换句话说，渲染树描述了 DOM 的直观的表现形式。</span><br style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px;"/><span style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px; background-color: rgb(255, 255, 255);">  4. 对每个渲染元素来说，它的坐标是经过计算的，这被叫做“布局(layout)”。浏览器使用一种只需要一次处理的“流方法”来布局所有元素（tables需要多次处理）。</span><br style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px;"/><span style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px; background-color: rgb(255, 255, 255);">  5. 最后，将布局显示在浏览器窗口中，这个过程叫做“绘制(painting)”。</span><br style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px;"/><br style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px;"/><span style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px; background-color: rgb(255, 255, 255);">当在页面上修改了一些不需要改变定位的样式的时候（比如background-color,border-color,visibility)，浏览器只会将新的样式重新绘制给元素（这就叫一次“重绘”或者“重新定义样式”）。</span><br style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px;"/><br style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px;"/><span style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px; background-color: rgb(255, 255, 255);">当页面上的改变影响了文档内容、结构或者元素定位时，就会发生重排（或称“重新布局”）。重排通常由以下改变触发：</span><br style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px;"/><br style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px;"/><span style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px; background-color: rgb(255, 255, 255);">  * DOM 操作（如元素增、删、改或者改变元素顺序）。</span><br style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px;"/><span style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px; background-color: rgb(255, 255, 255);">  * 内容的改变，包括 Form 表单中文字变化。</span><br style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px;"/><span style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px; background-color: rgb(255, 255, 255);">  * 计算或改变 CSS 属性。</span><br style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px;"/><span style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px; background-color: rgb(255, 255, 255);">  * 增加或删除一个样式表。</span><br style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px;"/><span style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px; background-color: rgb(255, 255, 255);">  * 改变”class”属性。</span><br style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px;"/><span style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px; background-color: rgb(255, 255, 255);">  * 浏览器窗口的操作（改变大小、滚动窗口）。</span><br style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px;"/><span style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px; background-color: rgb(255, 255, 255);">  * 激活伪类（如:hover状态）。</span><br style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px;"/><br style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px;"/><span style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px; background-color: rgb(255, 255, 255);">浏览器如何优化渲染？</span><br style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px;"/><br style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px;"/><span style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px; background-color: rgb(255, 255, 255);">浏览器尽最大努力限制重排的过程仅覆盖已更改的元素的区域。举个例子，一个 position 为 absolue 或 fixed 的元素的大小变化只影响它自身和子孙元素，而对一个 position 为 static 的元素做同样的操作就会引起所有它后面元素的重排。</span><br style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px;"/><br style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px;"/><span style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px; background-color: rgb(255, 255, 255);">另一个优化就是当运行一段Jjavascript 代码的时候，浏览器会将一些修改缓存起来，然后当代码执行的时候，一次性的将这些修改执行。举例来说，这段代码会触发一次重绘和一次重排：</span><br style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px;"/><br style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px;"/><span style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px; background-color: rgb(255, 255, 255);">var $body = $('body');</span><br style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px;"/><br style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px;"/><span style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px; background-color: rgb(255, 255, 255);">$body.css('padding', '1px'); // 重排, 重绘</span><br style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px;"/><br style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px;"/><span style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px; background-color: rgb(255, 255, 255);">$body.css('color', 'red'); // 重绘</span><br style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px;"/><br style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px;"/><span style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px; background-color: rgb(255, 255, 255);">$body.css('margin', '2px'); // 重排, 重绘</span><br style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px;"/><br style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px;"/><span style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px; background-color: rgb(255, 255, 255);">// 实际上只有一次重排和重绘被执行。</span><br style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px;"/><br style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px;"/><span style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px; background-color: rgb(255, 255, 255);">如上面所说，访问一个元素的属性会进行一次强制重排。如果我们给上面的代码加上一行读取元素属性的代码，这个情况就会出现：</span><br style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px;"/><br style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px;"/><span style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px; background-color: rgb(255, 255, 255);">var $body = $('body');</span><br style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px;"/><br style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px;"/><span style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px; background-color: rgb(255, 255, 255);">$body.css('padding', '1px');</span><br style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px;"/><br style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px;"/><span style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px; background-color: rgb(255, 255, 255);">$body.css('padding'); // 这里读取了一次元素的属性，一次强制重排就会发生。</span><br style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px;"/><br style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px;"/><span style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px; background-color: rgb(255, 255, 255);">$body.css('color', 'red');</span><br style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px;"/><br style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px;"/><span style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px; background-color: rgb(255, 255, 255);">$body.css('margin', '2px');</span><br style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px;"/><br style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px;"/><span style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px; background-color: rgb(255, 255, 255);">上面这段代码的结果就是，进行了两次重排。因此，为了提高性能，你应该讲读取元素属性的代码组织在一起（细节的例子可以看JSBin上的代码）。</span><br style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px;"/><br style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px;"/><span style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px; background-color: rgb(255, 255, 255);">有一种情况是必须触发一次强制重排的。例如：给元素改变同一个属性两次（比如margin-left），一开始设置100px，没有动画，然后通过动画的形式将值改为50px。具体可以看例子，当然，我在这里会讲更多的细节。</span><br style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px;"/><br style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px;"/><span style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px; background-color: rgb(255, 255, 255);">我们从一个有transition的CSS class开始：</span><br style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px;"/><br style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px;"/><span style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px; background-color: rgb(255, 255, 255);">.has-transition {</span><br style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px;"/><br style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px;"/><span style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px; background-color: rgb(255, 255, 255);">-webkit-transition: margin-left 1s ease-out;</span><br style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px;"/><br style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px;"/><span style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px; background-color: rgb(255, 255, 255);">-moz-transition: margin-left 1s ease-out;</span><br style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px;"/><br style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px;"/><span style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px; background-color: rgb(255, 255, 255);">-o-transition: margin-left 1s ease-out;</span><br style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px;"/><br style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px;"/><span style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px; background-color: rgb(255, 255, 255);">transition: margin-left 1s ease-out;</span><br style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px;"/><br style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px;"/><span style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px; background-color: rgb(255, 255, 255);">}</span><br style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px;"/><br style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px;"/><span style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px; background-color: rgb(255, 255, 255);">然后进行实现：</span><br style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px;"/><br style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px;"/><span style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px; background-color: rgb(255, 255, 255);">//我们的元素默认有&quot;has-transition&quot;属性</span><br style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px;"/><br style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px;"/><span style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px; background-color: rgb(255, 255, 255);">var $targetElem = $('#targetElemId');</span><br style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px;"/><br style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px;"/><span style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px; background-color: rgb(255, 255, 255);">//删除包含transition的class</span><br style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px;"/><br style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px;"/><span style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px; background-color: rgb(255, 255, 255);">$targetElem.removeClass('has-transition');</span><br style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px;"/><br style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px;"/><span style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px; background-color: rgb(255, 255, 255);">// 当包含transition的class已经没了的时候，改变元素属性</span><br style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px;"/><br style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px;"/><span style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px; background-color: rgb(255, 255, 255);">$targetElem.css('margin-left', 100);</span><br style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px;"/><br style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px;"/><span style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px; background-color: rgb(255, 255, 255);">// 再将包含transition的class添加回来</span><br style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px;"/><br style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px;"/><span style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px; background-color: rgb(255, 255, 255);">$targetElem.addClass('has-transition');</span><br style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px;"/><br style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px;"/><span style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px; background-color: rgb(255, 255, 255);">// 改变元素属性</span><br style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px;"/><br style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px;"/><span style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px; background-color: rgb(255, 255, 255);">$targetElem.css('margin-left', 50);</span><br style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px;"/><br style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px;"/><span style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px; background-color: rgb(255, 255, 255);">上面的实现没有按照期望的运行。所有的修改都被浏览器缓存了，只在上面这段代码的最后才会执行。我们需要的是一次强制重排，我们可以通过进行以下修改来实现：</span><br style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px;"/><br style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px;"/><span style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px; background-color: rgb(255, 255, 255);">//删除包含transition的class</span><br style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px;"/><br style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px;"/><span style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px; background-color: rgb(255, 255, 255);">$(this).removeClass('has-transition');</span><br style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px;"/><br style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px;"/><span style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px; background-color: rgb(255, 255, 255);">// 改变元素属性</span><br style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px;"/><br style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px;"/><span style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px; background-color: rgb(255, 255, 255);">$(this).css('margin-left', 100);</span><br style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px;"/><br style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px;"/><span style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px; background-color: rgb(255, 255, 255);">//触发一次强制重排，从而使变化了的class或属性能够立即执行。</span><br style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px;"/><br style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px;"/><span style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px; background-color: rgb(255, 255, 255);">$(this)[0].offsetHeight; // offsetHeight仅仅是个例子，其他的属性也可以奏效。</span><br style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px;"/><br style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px;"/><span style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px; background-color: rgb(255, 255, 255);">// 再将包含transition的class添加回来</span><br style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px;"/><br style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px;"/><span style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px; background-color: rgb(255, 255, 255);">$(this).addClass('has-transition');</span><br style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px;"/><br style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px;"/><span style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px; background-color: rgb(255, 255, 255);">// 改变元素属性</span><br style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px;"/><br style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px;"/><span style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px; background-color: rgb(255, 255, 255);">$(this).css('margin-left', 50);</span><br style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px;"/><br style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px;"/><span style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px; background-color: rgb(255, 255, 255);">现在这段代码如我们所期望的运行了。</span><br style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px;"/><br style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px;"/><span style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px; background-color: rgb(255, 255, 255);">实际的优化建议</span><br style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px;"/><br style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px;"/><span style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px; background-color: rgb(255, 255, 255);">汇总了一些有用的信息，我建议以下几点：</span><br style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px;"/><br style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px;"/><span style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px; background-color: rgb(255, 255, 255);">  * 创建合法的 HTML 和 CSS ，别忘了制定文件编码，Style 应该写在 head 标签中，script 标签应该加载 body 标签结束的位置。</span><br style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px;"/><span style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px; background-color: rgb(255, 255, 255);">  * 试着简化和优化 CSS 选择器（这个优化点被大多数使用 CSS 预处理器的开发者忽略了）。将嵌套层数控制在最小。以下是 CSS 选择器的性能排行（从最快的开始）：</span><br style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px;"/><br style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px;"/><br style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px;"/><span style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px; background-color: rgb(255, 255, 255);">  1. ID选择器：#id</span><br style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px;"/><span style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px; background-color: rgb(255, 255, 255);">  2. class选择器： .class</span><br style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px;"/><span style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px; background-color: rgb(255, 255, 255);">  3. 标签: div</span><br style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px;"/><span style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px; background-color: rgb(255, 255, 255);">  4. 相邻的兄弟元素：a + i</span><br style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px;"/><span style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px; background-color: rgb(255, 255, 255);">  5. 父元素选择器： ul &gt; li</span><br style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px;"/><span style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px; background-color: rgb(255, 255, 255);">  6. 通配符选择器： *</span><br style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px;"/><span style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px; background-color: rgb(255, 255, 255);">  7. 伪类和伪元素： a:hover ，你应该记住浏览器处理选择器是从右向左的，这也就是为什么最右面的选择器会更快——#id或.class。</span><br style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px;"/><br style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px;"/><span style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px; background-color: rgb(255, 255, 255);">div * {...} // bad</span><br style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px;"/><br style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px;"/><span style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px; background-color: rgb(255, 255, 255);">.list li {...} // bad</span><br style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px;"/><br style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px;"/><span style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px; background-color: rgb(255, 255, 255);">.list-item {...} // good</span><br style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px;"/><br style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px;"/><span style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px; background-color: rgb(255, 255, 255);">#list .list-item {...} // good</span><br style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px;"/><br style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px;"/><span style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px; background-color: rgb(255, 255, 255);">  1. 在你的脚本中，尽可能的减少 DOM 的操作。把所有东西都缓存起来，包括属性和对象（如果它可被重复使用）。进行复杂的操作的时候，最好操作一个“离线”的元素（“离线”元素的意思是与 DOM 对象分开、仅存在内存中的元素），然后将这个元素插入到 DOM 中。</span><br style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px;"/><span style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px; background-color: rgb(255, 255, 255);">  2. 如果你使用 jQuery，遵循</span><a href="http://learn.jquery.com/performance/optimize-selectors/" style="margin: 0px; padding: 0px; border: 0px; font: inherit; vertical-align: baseline; text-decoration: none; color: rgb(51, 51, 51); font-family: Helvetica, Arial; line-height: 21px;">jQuery 选择器最佳实践</a><br style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px;"/><span style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px; background-color: rgb(255, 255, 255);">  3. 要改变元素的样式，修改“class”属性是最高效的方式之一。你要改变 DOM 树的层次越深，这一条就越高效（这也有助于将表现和逻辑分开）。</span><br style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px;"/><span style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px; background-color: rgb(255, 255, 255);">  4. 尽可能的只对 position 为 absolute 或 fix 的元素做动画。</span><br style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px;"/><span style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px; background-color: rgb(255, 255, 255);">  5. 当滚动时禁用一些复杂的 :hover 动画是一个很好的主意（例如，给 body 标签加一个 no-hover 的 class）关于这个</span><a href="http://habrahabr.ru/post/204238/" style="margin: 0px; padding: 0px; border: 0px; font: inherit; vertical-align: baseline; text-decoration: none; color: rgb(51, 51, 51); font-family: Helvetica, Arial; line-height: 21px;">主题的文章</a><span style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px; background-color: rgb(255, 255, 255);">。</span><br style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px;"/><br style="color: rgb(51, 51, 51); font-family: Helvetica, Arial; font-size: 14px; line-height: 21px;"/><div style="margin: 0px 0px 1.5em; padding: 0px; border: 0px; font: inherit; vertical-align: baseline; color: rgb(51, 51, 51); font-family: Helvetica, Arial; line-height: 21px;">更多细节：</div><div style="margin: 0px 0px 1.5em; padding: 0px; border: 0px; font: inherit; vertical-align: baseline; color: rgb(51, 51, 51); font-family: Helvetica, Arial; line-height: 21px;"><ol style="margin: 0px 0px 20px; padding: 0px; border: 0px; font: inherit; vertical-align: baseline; list-style: inside; color: rgb(0, 0, 0);"><li style="margin: 0px; padding: 0px; border: 0px; font-size: 14px; font: inherit; vertical-align: baseline; list-style: decimal inside;"><a href="http://taligarsiel.com/Projects/howbrowserswork1.htm" style="margin: 0px; padding: 0px; border: 0px; font-size: 14px; font: inherit; vertical-align: baseline; text-decoration: none; color: rgb(0, 153, 204);">How browsers work</a></li><li style="margin: 0px; padding: 0px; border: 0px; font-size: 14px; font: inherit; vertical-align: baseline; list-style: decimal inside;"><a href="http://www.phpied.com/rendering-repaint-reflowrelayout-restyle/" style="margin: 0px; padding: 0px; border: 0px; font-size: 14px; font: inherit; vertical-align: baseline; text-decoration: none; color: rgb(0, 153, 204);">Rendering: repaint, reflow/relayout, restyle</a></li></ol></div></div><div><b><br/></b></div><div><br/></div><div><br/></div></span>
</div></body></html> 